Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&Infinity!=d&&-Infinity!=d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1});var debug=!1,timeoutFilterUpdate=333,absoluteGraphThreshold=200;
Function.prototype.extend=function(){function a(){}a.prototype=this.prototype;return new a};Array.prototype.size=function(){return this.length};Array.prototype.contains=function(a){return this.indexOf(a)!=-1};Array.prototype.containsAll=function(a){for(var b=0;b<a.length;b++)if(!this.contains(a[b]))return false;return true};Array.prototype.isEmpty=function(){return this.length==0};Array.prototype.clone=function(){for(var a=Array(this.length),b=0;b<this.length;b++)a[b]=this[b];return a};
Array.prototype.clear=function(){this.length=0};Array.prototype.add=function(a,b){arguments.length==2?this.splice(a,0,b):this.push(a)};Array.prototype.addAll=function(a,b){if(arguments.length==2){var c=this.length,d=b.length;this.length=this.length+d;for(c=c-1;c>=a;c--)this[c+d]=this[c];for(c=0;c<d;c++)this[c+a]=b[c]}else for(c=0;c<a.length;c++)this.push(a[c])};Array.prototype.remove=function(a){a=this.indexOf(a);if(a!=-1){this.splice(a,1);return true}return false};
Array.prototype.removeAll=function(a){for(var b=0;b<a.length;b++)this.remove(a[b])};Array.prototype.retainAll=function(a){for(var b=this.length-1;b>=0;b--)a.contains(this[b])||this.splice(b,1)};
if("undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.measureText||(CanvasRenderingContext2D.prototype.measureText=function(a){this.mozTextStyle=this.font;return{width:this.mozMeasureText(a)}}),!CanvasRenderingContext2D.prototype.fillText))CanvasRenderingContext2D.prototype.fillText=function(a,b,c){this.mozTextStyle=this.font;this.save();this.translate(b,c);this.mozDrawText(a);this.restore()};function Tree(){this.clear()}
Tree._Node=function(a,b){this.outgoing=[];this.incoming=[];this.children=[];this.tree=a;this.index=a.nodes.length;this.parent=b;a.nodes.add(this)};Tree._Node.prototype.addChild=function(){var a=new Tree._Node(this.tree,this);this.children.add(a);return a};Tree._Node.prototype.removeChild=function(a){this.children.remove(a);a.clearEdges();a.clearChildren();this.tree.nodes.splice(a.index,1);for(var a=a.index,b=this.tree.nodes.length;a<b;a++)this.tree.nodes[a].index=a};
Tree._Node.prototype.clearChildren=function(){for(var a=0;a<this.children.length;a++)this.removeChild(this.children[a])};Tree._Node.prototype.addEdge=function(a){a.incoming.push(this);this.outgoing.push(a)};Tree._Node.prototype.removeEdge=function(a){if(a.incoming.remove(this)){this.outgoing.remove(a);return true}return false};
Tree._Node.prototype.clearEdges=function(){for(var a=0;a<this.incoming.length;a++)this.incoming[a].outgoing.remove(this);for(a=0;a<this.outgoing.length;a++)this.outgoing[a].incoming.remove(this);this.incoming=[];this.outgoing=[]};Tree._Node.prototype.hideEdges=function(){for(var a=0;a<this.incoming.length;a++)this.incoming[a].outgoing.hide(this);for(a=0;a<this.outgoing.length;a++)this.outgoing[a].incoming.hide(this);this.incoming=[];this.outgoing=[]};
Tree._Node.prototype.ancestors=function(){for(var a=[],b=this,c=this.parent;c!=null;){a.add(b);b=c;c=c.parent}a.add(b);return a};Tree.prototype.clear=function(){this.nodes=[];this.root=new Tree._Node(this,null)};Tree.prototype.leastCommonAncestor=function(a,b){if(a==b)return a;for(var c=a.ancestors(),d=b.ancestors(),e=c.pop(),f=d.pop(),k=null;e==f;){k=e;e=c.pop();f=d.pop()}return k};function Vector(a,b){this.x=a;this.y=b}
Vector.prototype.distance=function(a,b){var c=this.x-a,d=this.y-b;return Math.sqrt(c*c+d*d)};Vector.prototype.perp=function(){return new Vector(-this.y,this.x)};Vector.prototype.dot=function(a){return this.x*a.x+this.y*a.y};Vector.prototype.cross=function(a){return this.x*a.y-this.y*a.x};Vector.prototype.toString=function(){return"("+this.x+", "+this.y+")"};function Path(){}Path.Segment=function(a,b){this.type=a;this.points=b};Path.SEG_MOVE=1;Path.SEG_LINE=2;Path.SEG_BEZIER=3;
Path.prototype._path=function(a){a.beginPath();for(var b=this.segments(),c=0;c<b.length;c++){var d=b[c];switch(d.type){case Path.SEG_MOVE:var e=d.points[0];a.moveTo(e.x,e.y);break;case Path.SEG_LINE:e=d.points[0];a.lineTo(e.x,e.y);break;case Path.SEG_BEZIER:var e=d.points[0],f=d.points[1],d=d.points[2];a.bezierCurveTo(f.x,f.y,d.x,d.y,e.x,e.y)}}};Path.prototype.fill=function(a){this._path(a);a.fill();return this};Path.prototype.stroke=function(a){this._path(a);a.stroke();return this};
Path.prototype.contains=function(a,b,c){this._path(a);return a.isPointInPath(b,c)};Path.prototype.segments=function(){if(!this._segments)this._segments=[];return this._segments};Path.prototype.moveTo=function(a,b){this.segments().add(new Path.Segment(Path.SEG_MOVE,[new Vector(a,b)]));return this};Path.prototype.lineTo=function(a,b){this.segments().add(new Path.Segment(Path.SEG_LINE,[new Vector(a,b)]));return this};
Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){this.segments().add(new Path.Segment(Path.SEG_BEZIER,[new Vector(e,f),new Vector(a,b),new Vector(c,d)]));return this};Path.prototype.intersects=function(a,b){for(var c=this._clone().flatten(b)._segments,d=a._clone().flatten(b)._segments,e=0;e<c.length;e++)if(c[e].type==Path.SEG_LINE)for(var f=c[e-1].points[0],k=c[e].points[0],h=0;h<d.length;h++)if(d[h].type==Path.SEG_LINE&&Line.intersect(f,k,d[h-1].points[0],d[h].points[0]))return true;return false};
Path.prototype.transform=function(a){for(var b=this.segments(),c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.points.length;e++)d.points[e]=a.transform(d.points[e]);return this};Path.prototype.flat=function(){for(var a=this.segments(),b=0;b<a.length;b++)if(a[b].type==Path.SEG_BEZIER)return false;return true};
Path.prototype.flatten=function(a){function b(d,e,f,j){var g=new Line(d.x,d.y,j.x,j.y);if(g.distance(e.x,e.y)<=a&&g.distance(f.x,f.y)<=a)c.lineTo(j.x,j.y);else{var l=Path._weightCurve(Path._bezierLeft[1],d,e,f,j),n=Path._weightCurve(Path._bezierLeft[2],d,e,f,j),g=Path._weightCurve(Path._bezierLeft[3],d,e,f,j);b(d,l,n,g);l=Path._weightCurve(Path._bezierRight[1],d,e,f,j);d=Path._weightCurve(Path._bezierRight[2],d,e,f,j);b(g,l,d,j)}}var c=this;if(this.flat())return this;a||(a=1);var d=this.segments();
this._segments=[];for(var e=0;e<d.length;e++){var f=d[e];switch(f.type){case Path.SEG_BEZIER:b(d[e-1].points[0],f.points[1],f.points[2],f.points[0]);break;default:this._segments.add(f)}}return this};
Path.prototype.split=function(a,b){var c=this._clone().flatten(b)._segments,d=0,e=Array(c.length);e[0]=0;for(var f=1;f<c.length;f++){var k=c[f-1].points[0],h=c[f].points[0];e[f]=d=d+k.distance(h.x,h.y)}for(f=1;f<c.length;f++)e[f]=e[f]/d;for(var d=Array(a),h=k=c[0].points[0],f=0,i=1;f<a;f++){for(var j=(new Path).moveTo(h.x,h.y),g=(f+1)/a;e[i]<g;){k=c[i++].points[0];j.lineTo(k.x,k.y)}h=c[i].points[0];e[i]==g?k=c[i++].points[0]:h=new Vector(k.x*(1-(g-e[i-1])/(e[i]-e[i-1]))+h.x*((g-e[i-1])/(e[i]-e[i-
1])),k.y*(1-(g-e[i-1])/(e[i]-e[i-1]))+h.y*((g-e[i-1])/(e[i]-e[i-1])));j.lineTo(h.x,h.y);d[f]=j}return d};Path.prototype.clear=function(){this.segments().clear();return this};Path.prototype._clone=function(){var a=new Path;a._segments=this.segments();return a};Path._weightCurve=function(a,b,c,d,e){return new Vector(a[0]*b.x+a[1]*c.x+a[2]*d.x+a[3]*e.x,a[0]*b.y+a[1]*c.y+a[2]*d.y+a[3]*e.y)};Path._bezierLeft=[[1,0,0,0],[0.5,0.5,0,0],[0.25,0.5,0.25,0],[0.125,0.375,0.375,0.125]];
Path._bezierRight=[[0.125,0.375,0.375,0.125],[0,0.25,0.5,0.25],[0,0,0.5,0.5],[0,0,0,1]];function AffineTransform(){this._matrix=[1,0,0,0,1,0]}AffineTransform.prototype.rotate=function(a){var b=Math.cos(a),a=Math.sin(a),c=this._matrix.clone();this._matrix[0]=c[0]*b-c[1]*a;this._matrix[1]=c[0]*a+c[1]*b;this._matrix[3]=c[3]*b-c[4]*a;this._matrix[4]=c[3]*a+c[4]*b;return this};
AffineTransform.prototype.scale=function(a,b){arguments.length==1&&(b=a);this._matrix[0]=this._matrix[0]*a;this._matrix[1]=this._matrix[1]*b;this._matrix[3]=this._matrix[3]*a;this._matrix[4]=this._matrix[4]*b;return this};AffineTransform.prototype.shear=function(a,b){var c=this._matrix.clone();this._matrix[0]=c[0]+c[1]*b;this._matrix[1]=c[0]*a+c[1];this._matrix[3]=c[3]+c[4]*b;this._matrix[4]=c[3]*a+c[4];return this};
AffineTransform.prototype.translate=function(a,b){this._matrix[2]=this._matrix[0]*a+this._matrix[1]*b+this._matrix[2];this._matrix[5]=this._matrix[3]*a+this._matrix[4]*b+this._matrix[5];return this};AffineTransform.prototype.transform=function(a){return new Vector(this._matrix[0]*a.x+this._matrix[1]*a.y+this._matrix[2],this._matrix[3]*a.x+this._matrix[4]*a.y+this._matrix[5])};function BasisSpline(){Path.call(this);this._points=[]}BasisSpline.prototype=Path.extend();
BasisSpline.prototype.add=function(a,b){this._points.push(new Vector(a,b));this._segments=null;return this};BasisSpline.prototype.addAll=function(a){this._points.addAll(a);this._segments=null;return this};BasisSpline.prototype.clear=function(){this._points=[];this._segments=null;return this};
BasisSpline.prototype.straighten=function(a){for(var b=this._points,c=b.length-1,d=b[c].x-b[0].x,e=b[c].y-b[0].y,f=1;f<c;f++){var k=b[f];k.x=a*k.x+(1-a)*(b[0].x+f*d/c);k.y=a*k.y+(1-a)*(b[0].y+f*e/c)}this._segments=null;return this};BasisSpline.prototype.points=function(){return this._points};
BasisSpline.prototype.segments=function(){if(this._segments)return this._segments;this._segments=[];var a=this._points;if(!a)throw Function.stacktrace();switch(a.length){case 0:break;case 1:this.moveTo(a[0].x,a[0].y);break;case 2:this.moveTo(a[0].x,a[0].y);this.lineTo(a[1].x,a[1].y);break;default:this.moveTo(a[0].x,a[0].y);var b=a[0],c=b,d=b,e=a[1];this._basisCurveTo(b,c,d,e);for(var f=2;f<a.length;f++){b=c;c=d;d=e;e=a[f];this._basisCurveTo(b,c,d,e)}for(a=0;a<2;a++){b=c;c=d;d=e;this._basisCurveTo(b,
c,d,e)}}return this._segments};BasisSpline._basisToBezier=[[1/6,4/6,1/6,0],[0,4/6,2/6,0],[0,2/6,4/6,0],[0,1/6,4/6,1/6]];BasisSpline.prototype._basisCurveTo=function(a,b,c,d){var e=Path._weightCurve(BasisSpline._basisToBezier[1],a,b,c,d),f=Path._weightCurve(BasisSpline._basisToBezier[2],a,b,c,d),a=Path._weightCurve(BasisSpline._basisToBezier[3],a,b,c,d);this.bezierCurveTo(e.x,e.y,f.x,f.y,a.x,a.y)};function Circle(a,b,c){this.center=new Vector(a,b);this.radius=c}
Circle.prototype._path=function(a){a.beginPath();a.arc(this.center.x,this.center.y,this.radius,0,2*Math.PI,false)};Circle.prototype.fill=function(a){this._path(a);a.fill();return this};Circle.prototype.stroke=function(a){this._path(a);a.stroke();return this};Circle.prototype.distance=function(a,b){return this.center.distance(a,b)-this.radius};Circle.prototype.diameter=function(){return 2*this.radius};Circle.prototype.circumference=function(){return 2*Math.PI*this.radius};
Circle.prototype.area=function(){return Math.PI*this.radius*this.radius};function Line(a,b,c,d){Path.call(this);this._segments=[new Path.Segment(Path.SEG_MOVE,[new Vector(a,b)]),new Path.Segment(Path.SEG_LINE,[new Vector(c,d)])]}Line.prototype=Path.extend();Line.prototype.distance=function(a,b){var c=this.start(),d=this.end(),e=d.x-c.x,d=d.y-c.y;return e==0&&d==0?c.distance(a,b):Math.abs(e*(c.y-b)-d*(c.x-a))/Math.sqrt(e*e+d*d)};Line.prototype.start=function(){return this._segments[0].points[0]};
Line.prototype.end=function(){return this._segments[1].points[0]};Line.prototype.length=function(){return this.start().distance(this.end())};Line.intersect=function(a,b,c,d){d=new Vector(d.x-c.x,d.y-c.y);b=new Vector(a.y-b.y,b.x-a.x);a=new Vector(a.x-c.x,a.y-c.y);c=a.dot(d.perp());d=d.dot(b);if(d>0){if(c<0||c>d)return false}else if(c>0||c<d)return false;b=a.dot(b);if(d>0){if(b<0||b>d)return false}else if(b>0||b<d)return false;return true};
function BundledEdgeRouter(a,b){this.beta=0.85;this.tree=a;this.layout=b;this.splines=null}
BundledEdgeRouter.prototype._spline=function(a,b){var c=this.tree.nodes[a],d=this.tree.nodes[b];if(factbook.dependencyData[c.name][d.name].d!=0){var e=this.tree.leastCommonAncestor(c,d),f=[];for(f.add(this.transformPoint(this.layout.position(a)));c!=e;){c=c.parent;f.add(this.transformPoint(this.layout.position(c.index)))}for(c=f.size();d!=e;){f.add(c,this.transformPoint(this.layout.position(d.index)));d=d.parent}d=(new BasisSpline).addAll(f).straighten(this.beta);d._start=a;d._end=b;return d}};
BundledEdgeRouter.prototype.init=function(){this.splines=[];for(var a,b=0;b<this.tree.nodes.length;b++)for(var c=0;c<this.tree.nodes[b].outgoing.length;c++)(a=this._spline(b,this.tree.nodes[b].outgoing[c].index))&&this.splines.add(a)};BundledEdgeRouter.prototype.draw=function(a){for(var b=0;b<this.splines.length;b++)this.drawSpline(a,b)};BundledEdgeRouter.prototype.drawSpline=function(a,b){this.splines[b].stroke(a)};BundledEdgeRouter.prototype.transformPoint=function(a){return a};
function CircleLayout(a){this.endAngle=2*Math.PI;this.startRadius=this.startAngle=0;this.tree=a}
CircleLayout.prototype.init=function(){function a(b,c){c>f&&(f=c);e[b.index]=c;(c>0||b.children.length>1)&&c++;for(var i=b.children.length==0?1:0,j=0;j<b.children.length;j++)i=i+a(b.children[j],c);i==b.children.length&&i++;return d[b.index]=i}function b(a,f,i){var j;j=(f+i)/2-Math.PI/2;var g=e[a.index],l=g==0?0:c.startRadius+radiusScale*g,g=Math.cos(j)*l,l=Math.sin(j)*l;c._positions[a.index]=new Vector(g,l);c._angles[a.index]=j;i=(i-f)/d[a.index];a=a.children;if(c.sort){a=a.clone();a.sort(c.sort)}for(g=
j=0;g<a.length;g++){l=j+d[a[g].index];b(a[g],f+j*i,f+l*i);j=l}}this._positions=[];this._angles=[];var c=this,d=Array(this.tree.nodes.length),e=Array(this.tree.nodes.length),f=0;a(this.tree.root,0);radiusScale=(1-this.startRadius)/f;b(this.tree.root,this.startAngle,this.endAngle)};CircleLayout.prototype.position=function(a){return this._positions[a]};CircleLayout.prototype.angle=function(a){return this._angles[a]};
CircleLayout.prototype.outline=function(){var a=this,b=this.tree.nodes.clone();b.sort(function(b,c){return a.angle(b.index)-a.angle(c.index)});for(var c=new Path,d=0;d<b.length;d++)if(b[d].children.length==0){var e=this.position(b[d].index);c.segments().length==0?c.moveTo(e.x,e.y):c.lineTo(e.x,e.y)}return c};function Color(){}Color.Rgb=function(a,b,c,d){this.r=a;this.g=b;this.b=c;this.a=d};Color.Rgb.prototype.rgb=function(){return this};
Color.Rgb.prototype.toString=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"};Color.white=new Color.Rgb(255,255,255,1);Color.red=new Color.Rgb(255,0,0,1);Color.green=new Color.Rgb(0,255,0,1);Color.blue=new Color.Rgb(0,0,255,1);Color.black=new Color.Rgb(0,0,0,1);function Gradient(a,b){this.start=a.rgb();this.end=b.rgb()}
Gradient.prototype.color=function(a){return new Color.Rgb(Math.round(this.start.r*(1-a)+this.end.r*a),Math.round(this.start.g*(1-a)+this.end.g*a),Math.round(this.start.b*(1-a)+this.end.b*a),this.start.a*(1-a)+this.end.a*a)};function RadialLabeler(a,b){this.tree=a;this.layout=b}
RadialLabeler.prototype._drawNode=function(a,b){var c=this.transformPoint(this.layout.position(b));a.save();a.translate(c.x,c.y);a.fillStyle=this.style(this.tree.nodes[b])||a.fillStyle;var c=this.transformAngle(this.layout.angle(b)),d=this.name(this.tree.nodes[b]);if(this._upsideDown(c)){a.rotate(c+Math.PI);a.fillText(d,-a.measureText(d).width-2,2)}else{a.rotate(c);a.fillText(d,2,2)}a.restore()};
RadialLabeler.prototype._upsideDown=function(a){a=a%(2*Math.PI);a<0&&(a=a+2*Math.PI);return a>Math.PI/2&&a<1.5*Math.PI};RadialLabeler.prototype.draw=function(a){if(a.fillText)for(var b=0;b<this.tree.nodes.length;b++)this.tree.nodes[b].children.length==0&&this._drawNode(a,b)};RadialLabeler.prototype.name=function(a){return a.index};RadialLabeler.prototype.style=function(){return null};RadialLabeler.prototype.transformPoint=function(a){return a};RadialLabeler.prototype.transformAngle=function(a){return a};
RadialLabeler.prototype.nodeAt=function(a,b){for(var c=0,d=Infinity,e=1;e<this.tree.nodes.length;e++){var f=this.transformPoint(this.layout.position(e)).distance(a,b);if(f<d){c=e;d=f}}return this.tree.nodes[c]};function DependencyTree(){Tree.call(this);this._map={}}DependencyTree.prototype=Tree.extend();
DependencyTree.prototype.get=function(a){if(this._map[a])return this._map[a];var b=a.lastIndexOf("."),c=(b==-1?this.root:this.get(a.substring(0,b))).addChild();c.name=a.substring(b+1);c.fullName=a;c.region=a.substring(0,b);return this._map[a]=c};
function DependencyTreeControl(a){function b(a){for(var b=Array(h.nodes.length),d=Array(h.nodes.length),e=0;e<h.nodes.length;e++)b[e]=d[e]=0;var f=0;r!=null&&(new Line(r.start().x,r.start().y,r.end().x,r.end().y)).transform((new AffineTransform).translate(l/2,n/2).rotate(w).translate(-l/2,-n/2));for(var j={},k=false,e=0;e<o.splines.length;e++){var g=o.splines[e];g._active=t.countries.indexOf(h.nodes[g._start].name)>=0?false:true;if(g._active){j[m]=void 0;j[q]=void 0}var m=h.nodes[g._start].name,q=
h.nodes[g._end].name;g._active=g._active&&(m in s||q in s);if(u!=void 0&&g._active)g._active=i[m][q]!=void 0&&i[m][q]>=u;if(v!=void 0&&g._active)g._active=i[m][q]!=void 0&&i[m][q]<=v;if(g._active){f++;d[g._start]++;b[g._end]++}else k=true}for(e=0;e<h.nodes.length;e++)for(g=h.nodes[e].parent;g!=null;){b[g.index]=b[g.index]+b[e];d[g.index]=d[g.index]+d[e];g=g.parent}x=0.17+0.83/Math.sqrt(f);for(e=0;e<h.nodes.length;e++)h.nodes[e]._style=t.countries.indexOf(h.nodes[e].name)>=0?p.labelHighlighted:h.nodes[e].name in
s?p.labelStart:p.labelEnd;a&&c!=void 0&&c(j,k)}var c=function(){},d=document.createElement("canvas"),e=document.createElement("canvas");if(G_vmlCanvasManager!=void 0){G_vmlCanvasManager.initElement(d);G_vmlCanvasManager.initElement(e)}var f=a.getContext("2d"),d=d.getContext("2d");d.canvas.width=a.width;d.canvas.height=a.height;d.canvas.style.display="none";document.getElementById("canvas-placeholder").appendChild(d.canvas);var k=e.getContext("2d");k.canvas.width=a.width;k.canvas.height=a.height;k.canvas.style.display=
"none";document.getElementById("canvas-placeholder").appendChild(k.canvas);var h=new DependencyTree,i={},e=0;for(m in factbook.dependencyData)if(d=country2region[m]){var d=d.region,j=h.get(d+"."+m),g={};for(E in factbook.dependencyData[m])if(d=country2region[E]){d=d.region;j.name.split("_");j.addEdge(h.get(d+"."+E));e++;g[E]=factbook.dependencyData[m][E].d}i[m]=g}var l=a.width-80,n=a.height-80,w=0,y=(new AffineTransform).translate((l+80)/2,n/2).scale(Math.min(l,n)/2-80),e=new CircleLayout(h);e.startRadius=
0.6;e.sort=function(a,b){var c=a.name==b.name?0:a.name>b.name?1:-1;return a.name.indexOf(" ")?c:c*-1};e.init();var q=new RadialLabeler(h,e);q.transformAngle=function(a){return a+w};q.transformPoint=function(a){return y.transform(a)};q.name=function(a){return a.name};q.style=function(a){return a._style};this.labeler=q;var o=new BundledEdgeRouter(h,e);o.transformPoint=function(a){return y.transform(a)};o.init();this.edgeRouter=o;for(var p=DependencyTreeControl._default,B=new Gradient(p.edgeStart,p.edgeEnd),
x=1,z=Array(o.splines.length),m=0;m<z.length;m++)z[m]=o.splines[m].flatten().split(8);o.draw=function(a){a.save();a.translate(l/2,n/2);a.rotate(w);a.translate(-l/2,-n/2);a.globalCompositeOperation=p.edgeComposite;a.strokeStyle=p.edgeHighlighted;for(var b=0;b<this.splines.length;b++){var c=this.splines[b];c._active||c.stroke(a)}for(c=0;c<8;c++){b=B.color((c+0.5)/8);b.a=x;a.strokeStyle=b.toString();for(b=0;b<this.splines.length;b++)this.splines[b]._active&&z[b][c].stroke(a)}a.restore()};e.outline().transform(y);
var r=null;this.init=function(){f.font="10pt Sans-Serif";b(false);a.style.background=p.background;f.clearRect(0,0,l,n);o.draw(f);if(r){f.strokeStyle=p.intersectStroke;f.fillStyle=p.intersectFill;r.stroke(f);(new Circle(r.start().x,r.start().y,2.5)).fill(f).stroke(f);(new Circle(r.end().x,r.end().y,2.5)).fill(f).stroke(f)}k.clearRect(0,0,l,n);k.drawImage(f.canvas,0,0,l,n);q.draw(f)};this.register=function(a){c=a};var s=investor_countries;this.filter=function(){for(var a=0;a<o.splines.length;a++)o.splines[a]._active=
h.nodes[o.splines[a]._start].name in s||h.nodes[o.splines[a]._end].name in s};var u,v;this.threshold=function(a,c){u=a;v=c;console.log(u);console.log(v);b(false)};var m=[],A;for(A in top_10_investors)m.push(A);var t={countries:m};this.highlight=function(a){t=a;f.clearRect(0,0,l,n);f.drawImage(k.canvas,0,0,l,n);this.drawLabels()};this.redraw=function(){console.log("graph_dependency_tree.js: redraw()");r=void 0;f.clearRect(0,0,l,n);this.drawSplines();k.clearRect(0,0,l,n);k.drawImage(f.canvas,0,0,l,
n);this.drawLabels()};this.drawLabels=function(){for(var a=Array(h.nodes.length),b=Array(h.nodes.length),c=0;c<h.nodes.length;c++)a[c]=b[c]=0;for(var d=0,c=0;c<o.splines.length;c++){var e=o.splines[c];if(e._active){d++;b[e._start]++;a[e._end]++}}for(c=0;c<h.nodes.length;c++)for(e=h.nodes[c].parent;e!=null;){a[e.index]=a[e.index]+a[c];b[e.index]=b[e.index]+b[c];e=e.parent}x=0.17+0.83/Math.sqrt(d);for(c=0;c<h.nodes.length;c++)h.nodes[c]._style=t.countries.indexOf(h.nodes[c].name)>=0?p.labelHighlighted:
a[c]>0&&b[c]==0?p.labelEnd:b[c]>0&&a[c]==0?p.labelStart:a[c]+b[c]>0?p.labelActive:p.labelInactive;q.draw(f)};this.drawSplines=function(){o.draw(f)}}
DependencyTreeControl._default={background:"transparent",edgeComposite:"lighter",edgeStart:new Color.Rgb(88,177,191),edgeEnd:new Color.Rgb(237,162,79),labelStart:"rgb(108, 201, 211)",labelEnd:"rgb(237, 162, 79)",labelActive:"rgb(218, 138, 28)",labelInactive:"rgba(223, 227, 166)",labelHighlighted:"rgb(149, 239, 244)",edgeHighlighted:"rgb(149, 239, 244)",intersectStroke:"white",intersectFill:"black"};
